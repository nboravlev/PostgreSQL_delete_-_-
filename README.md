# PostgreSQL_delete_-_-
Удаление большого числа строк из таблицы циклом по условию.


## Batch Delete Script for PostgreSQL
<b>Описание</b>
Этот PL/pgSQL-скрипт выполняет пакетное удаление данных из таблицы table_name, где created_at соответствует указанной дате ('2023-07-31'). Удаление выполняется порциями (batch delete), чтобы избежать блокировок и перегрузки базы данных.


### Как работает скрипт
1. Устанавливает лимит (`_limit`) на количество удаляемых строк за одну итерацию (по умолчанию 100000).
2. В цикле `LOOP`:
   - Выбирает `id` записей, подлежащих удалению (`batch`).
   - Удаляет эти записи с помощью `DELETE USING`.
   - Подсчитывает количество удаленных строк (`_deleted_rows`).
   - Фиксирует изменения (`COMMIT`) после каждой итерации.
   - Завершается, когда больше нет записей для удаления.
3. Выводит в лог (`RAISE NOTICE`):
   - Общее количество удаленных строк.
   - Дату самой старой записи после удаления.
  
После удаления записей из таблицы в PostgreSQL физическое место на диске не освобождается автоматически. Удаленные строки помечаются как «мёртвые», и PostgreSQL может повторно использовать это пространство. Однако, если вам нужно освободить место на диске, есть несколько способов:


![image](https://github.com/user-attachments/assets/ba44229f-db3a-4acc-9659-b359243961f9)


